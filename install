#!/bin/bash

INSTDIR=/usr/local/easy
LOGFILE=/var/log/easy.log

# Create user easy
adduser --no-create-home --disabled-login easy

# Crontab entry
#   TODO!

# Make sure instalation dir exist
if [ -e ${INSTDIR} ]; then
    echo;
else
    # Create instalation dir
    mkdir ${INSTDIR}
fi

# Copy file
cp -R ./bin ${INSTDIR}/
cp -R ./cfg ${INSTDIR}/
cp -R ./db ${INSTDIR}/
cp -R ./web ${INSTDIR}/

# Make sure database exist
if [ -e ${INSTDIR}/db/easy.db ]; then
    echo;
else
    # Create DB
    cd ${INSTDIR}/db && python init_db.py
fi

# Chenge ownership
chown -R easy:easy ${INSTDIR}/

# Create LOG file
if [ -e ${INSTDIR} ]; then 
echo --Install-- >> ${LOGFILE}
else
echo --Install-- > ${LOGFILE}
fi
chown easy:easy ${LOGFILE}
chmod 0644 ${LOGFILE}


# Install service
cp ./easy /etc/init.d
# Debian
update-rc.d easy defaults
update-rc.d easy enable
# SuSE
#insserv -r easy
#insserv easy
